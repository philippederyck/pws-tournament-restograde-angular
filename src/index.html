<!doctype html>
<html lang="en" style="height: 100%;">
<head>
  <meta charset="utf-8">
  <title>Restograde Angular</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/f5b647715d.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
</head>
<body class="d-flex flex-column min-vh-100">
  <app-root></app-root>
  <footer class="mt-auto bg-light font-small pt-2 mt-4">
    <div class="container-fluid text-center text-md-left">
      <div class="advertisement-row row m-3">
        <div id="advertisement-container" class="advertisement-col col-lg-8 offset-lg-2 text-center">
          Want to see your advertisement here? Get in touch!
        </div>
      </div>
    </div>
    <div class="footer-copyright text-center py-3">Restograde is a training application provided by
      <a href="https://pragmaticwebsecurity.com/" target="_blank"> Pragmatic Web Security</a>. All data in this application is fictional. Photos from
      <a href="https://unsplash.com" target="_blank">Unsplash</a>.

    </div>
  </footer>
  <script>
    let restaurant = "";

    // Listen for page-changing events (Cannot do it on DOMContentLoaded on Stackblitz)
    let targetNode = document.querySelector('body');
    let config = { attributes: false, childList: true, subtree: true };
    let observer = new MutationObserver(createAdvertisement);
    observer.observe(targetNode, config);

    // Check if a new restaurant page has been loaded. If so, insert the advertisement
    function createAdvertisement() {
      let restaurantNode = document.querySelector("h2");
      if(restaurantNode == null) {
        restaurant = "";
      }
      else {
        if(restaurantNode.textContent != restaurant) {
          restaurant = restaurantNode.textContent;

          // Select a review
          let reviews = document.querySelectorAll("h4");
          let reviewText = reviews[reviews.length - 1].querySelectorAll("span")[1].textContent;

          // Put review into the page
          let text = "<p>Here is the latest review for <i>" + restaurant + "</i>: <strong>" + reviewText + "</strong>. Come see if you agree, or prove them wrong! Book your table now at 1-800-EATINGOUT</p>";
          $("#advertisement-container").html(text);
        }
      }


    }
  </script>
</body>
</html>
